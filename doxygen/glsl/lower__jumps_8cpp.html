<html>
<head>
<title>Mesa Source Code Documentation</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head>
<body>
<div class="qindex">
<a class="qindex" href="../main/index.html">core</a> |
<a class="qindex" href="../glapi/index.html">glapi</a> |
<a class="qindex" href="../glsl/index.html">glsl</a> |
<a class="qindex" href="../vbo/index.html">vbo</a> |
<a class="qindex" href="../math/index.html">math</a> |
<a class="qindex" href="../shader/index.html">shader</a> |
<a class="qindex" href="../swrast/index.html">swrast</a> |
<a class="qindex" href="../swrast_setup/index.html">swrast_setup</a> |
<a class="qindex" href="../tnl/index.html">tnl</a> |
<a class="qindex" href="../tnl_dd/index.html">tnl_dd</a> |
<a class="qindex" href="../gbm/index.html">gbm</a>
</div>
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_9d873dbfec6053c8a46a8bdca18df976.html">glsl</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">lower_jumps.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This pass lowers jumps (break, continue, and return) to if/else structures.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="glsl__types_8h.html">glsl_types.h</a>&quot;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="ir_8h.html">ir.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for lower_jumps.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="lower__jumps_8cpp__incl.png" border="0" usemap="#lower__jumps_8cpp" alt=""/></div>
<map name="lower__jumps_8cpp" id="lower__jumps_8cpp">
<area shape="rect" id="node3" href="glsl__types_8h.html" title="glsl_types.h" alt="" coords="43,155,135,181"/><area shape="rect" id="node12" href="ir_8h.html" title="ir.h" alt="" coords="412,80,452,107"/><area shape="rect" id="node18" href="ralloc_8h.html" title="ralloc: a recursive memory allocator" alt="" coords="640,229,704,256"/><area shape="rect" id="node29" href="list_8h.html" title="Doubly&#45;linked list abstract container type." alt="" coords="584,155,635,181"/><area shape="rect" id="node34" href="ir__visitor_8h.html" title="ir_visitor.h" alt="" coords="248,155,331,181"/><area shape="rect" id="node36" href="ir__hierarchical__visitor_8h.html" title="ir_hierarchical_visitor.h" alt="" coords="355,155,509,181"/></map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structblock__record.html">block_record</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structloop__record.html">loop_record</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfunction__record.html">function_record</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structir__lower__jumps__visitor.html">ir_lower_jumps_visitor</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a6f3179c8016538e6626c5913135de0ff"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lower__jumps_8cpp.html#a6f3179c8016538e6626c5913135de0ff">jump_strength</a> { <br/>
&#160;&#160;<a class="el" href="lower__jumps_8cpp.html#a6f3179c8016538e6626c5913135de0ffa38a8950e64723fb66a8e582fd371a7b6">strength_none</a>, 
<a class="el" href="lower__jumps_8cpp.html#a6f3179c8016538e6626c5913135de0ffa9444b5f4f4d4795d7d7d26dd7ce1c245">strength_always_clears_execute_flag</a>, 
<a class="el" href="lower__jumps_8cpp.html#a6f3179c8016538e6626c5913135de0ffaeddb744f96850d4a1a76642c4423cfbc">strength_continue</a>, 
<a class="el" href="lower__jumps_8cpp.html#a6f3179c8016538e6626c5913135de0ffac64c6bcab4df40bce246007d64aecea2">strength_break</a>, 
<br/>
&#160;&#160;<a class="el" href="lower__jumps_8cpp.html#a6f3179c8016538e6626c5913135de0ffaba67936e0c32b99c49bccaf62a62f7d1">strength_return</a>
<br/>
 }</td></tr>
<tr class="memdesc:a6f3179c8016538e6626c5913135de0ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enum recording the result of analyzing how control flow might exit an IR node.  <a href="lower__jumps_8cpp.html#a6f3179c8016538e6626c5913135de0ff">More...</a><br/></td></tr>
<tr class="separator:a6f3179c8016538e6626c5913135de0ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a944075d04ef225e3ad06f44a8c28a2be"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lower__jumps_8cpp.html#a944075d04ef225e3ad06f44a8c28a2be">do_lower_jumps</a> (<a class="el" href="structexec__list.html">exec_list</a> *instructions, bool pull_out_jumps, bool lower_sub_return, bool lower_main_return, bool lower_continue, bool lower_break)</td></tr>
<tr class="separator:a944075d04ef225e3ad06f44a8c28a2be"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This pass lowers jumps (break, continue, and return) to if/else structures. </p>
<p>It can be asked to:</p>
<ol type="1">
<li>Pull jumps out of ifs where possible</li>
<li>Remove all "continue"s, replacing them with an "execute flag"</li>
<li>Replace all "break" with a single conditional one at the end of the loop</li>
<li>Replace all "return"s with a single return at the end of the function, for the main function and/or other functions</li>
</ol>
<p>Applying this pass gives several benefits:</p>
<ol type="1">
<li>All functions can be inlined.</li>
<li>nv40 and other pre-DX10 chips without "continue" can be supported</li>
<li>nv30 and other pre-DX10 chips with no control flow at all are better supported</li>
</ol>
<p>Continues are lowered by adding a per-loop "execute flag", initialized to true, that when cleared inhibits all execution until the end of the loop.</p>
<p>Breaks are lowered to continues, plus setting a "break flag" that is checked at the end of the loop, and trigger the unique "break".</p>
<p>Returns are lowered to breaks/continues, plus adding a "return flag" that causes loops to break again out of their enclosing loops until all the loops are exited: then the "execute flag" logic will ignore everything until the end of the function.</p>
<p>Note that "continue" and "return" can also be implemented by adding a dummy loop and using break. However, this is bad for hardware with limited nesting depth, and prevents further optimization, and thus is not currently performed. </p>
</div><h2 class="groupheader">Enumeration Type Documentation</h2>
<a class="anchor" id="a6f3179c8016538e6626c5913135de0ff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="lower__jumps_8cpp.html#a6f3179c8016538e6626c5913135de0ff">jump_strength</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enum recording the result of analyzing how control flow might exit an IR node. </p>
<p>Each possible value of jump_strength indicates a strictly stronger guarantee on control flow than the previous value.</p>
<p>The ordering of strengths roughly reflects the way jumps are lowered: jumps with higher strength tend to be lowered to jumps of lower strength. Accordingly, strength is used as a heuristic to determine which lowering to perform first.</p>
<p>This enum is also used by get_jump_strength() to categorize instructions as either break, continue, return, or other. When used in this fashion, strength_always_clears_execute_flag is not used.</p>
<p>The control flow analysis made by this optimization pass makes two simplifying assumptions:</p>
<ul>
<li>It ignores discard instructions, since they are lowered by a separate pass (<a class="el" href="lower__discard_8cpp.html" title="This pass moves discards out of if-statements.">lower_discard.cpp</a>).</li>
</ul>
<ul>
<li>It assumes it is always possible for control to flow from a loop to the instruction immediately following it. Technically, this is not true (since all execution paths through the loop might jump back to the top, or return from the function).</li>
</ul>
<p>Both of these simplifying assumtions are safe, since they can never cause reachable code to be incorrectly classified as unreachable; they can only do the opposite. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><em><a class="anchor" id="a6f3179c8016538e6626c5913135de0ffa38a8950e64723fb66a8e582fd371a7b6"></a>strength_none</em>&nbsp;</td><td class="fielddoc">
<p>Analysis has produced no guarantee on how control flow might exit this IR node. </p>
<p>It might fall out the bottom (with or without clearing the execute flag, if present), or it might continue to the top of the innermost enclosing loop, break out of it, or return from the function. </p>
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="a6f3179c8016538e6626c5913135de0ffa9444b5f4f4d4795d7d7d26dd7ce1c245"></a>strength_always_clears_execute_flag</em>&nbsp;</td><td class="fielddoc">
<p>The only way control can fall out the bottom of this node is through a code path that clears the execute flag. </p>
<p>It might also continue to the top of the innermost enclosing loop, break out of it, or return from the function. </p>
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="a6f3179c8016538e6626c5913135de0ffaeddb744f96850d4a1a76642c4423cfbc"></a>strength_continue</em>&nbsp;</td><td class="fielddoc">
<p>Control cannot fall out the bottom of this node. </p>
<p>It might continue to the top of the innermost enclosing loop, break out of it, or return from the function. </p>
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="a6f3179c8016538e6626c5913135de0ffac64c6bcab4df40bce246007d64aecea2"></a>strength_break</em>&nbsp;</td><td class="fielddoc">
<p>Control cannot fall out the bottom of this node, or continue the top of the innermost enclosing loop. </p>
<p>It can only break out of it or return from the function. </p>
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="a6f3179c8016538e6626c5913135de0ffaba67936e0c32b99c49bccaf62a62f7d1"></a>strength_return</em>&nbsp;</td><td class="fielddoc">
<p>Control cannot fall out the bottom of this node, continue to the top of the innermost enclosing loop, or break out of it. </p>
<p>It can only return from the function. </p>
</td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a944075d04ef225e3ad06f44a8c28a2be"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool do_lower_jumps </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structexec__list.html">exec_list</a> *&#160;</td>
          <td class="paramname"><em>instructions</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>pull_out_jumps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>lower_sub_return</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>lower_main_return</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>lower_continue</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>lower_break</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>References <a class="el" href="structir__lower__jumps__visitor.html#a961ff7030938c62df726c2cba64239a9">ir_lower_jumps_visitor::lower_break</a>, <a class="el" href="structir__lower__jumps__visitor.html#a74bb74ea551029d38bcfd2fee440773b">ir_lower_jumps_visitor::lower_continue</a>, <a class="el" href="structir__lower__jumps__visitor.html#a0c285771f4f4979a2c9c43d7d34cba12">ir_lower_jumps_visitor::lower_main_return</a>, <a class="el" href="structir__lower__jumps__visitor.html#a45268d74e17fc5eae65b8266dba540cb">ir_lower_jumps_visitor::lower_sub_return</a>, <a class="el" href="structir__lower__jumps__visitor.html#a357e9b9f3670d918008a5d7bdf4906ad">ir_lower_jumps_visitor::progress</a>, <a class="el" href="structir__lower__jumps__visitor.html#ac179e2d4224654555a736d19ffa067ad">ir_lower_jumps_visitor::pull_out_jumps</a>, and <a class="el" href="ir_8cpp.html#a9cac841ae8e15e35da2a524415495c17">visit_exec_list()</a>.</p>

<p>Referenced by <a class="el" href="ir__optimization_8h.html#a225eedb7a8fad75e2a6e05212b7f70ce">do_common_optimization()</a>, and <a class="el" href="test__optpass_8cpp.html#a8a19eefda8984dbd5d14e58acb3c3189">do_optimization()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="lower__jumps_8cpp_a944075d04ef225e3ad06f44a8c28a2be_cgraph.png" border="0" usemap="#lower__jumps_8cpp_a944075d04ef225e3ad06f44a8c28a2be_cgraph" alt=""/></div>
<map name="lower__jumps_8cpp_a944075d04ef225e3ad06f44a8c28a2be_cgraph" id="lower__jumps_8cpp_a944075d04ef225e3ad06f44a8c28a2be_cgraph">
<area shape="rect" id="node3" href="ir_8cpp.html#a9cac841ae8e15e35da2a524415495c17" title="Apply a visitor to each IR node in a list." alt="" coords="171,5,277,32"/></map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
