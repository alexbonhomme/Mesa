<html>
<head>
<title>Mesa Source Code Documentation</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head>
<body>
<div class="qindex">
<a class="qindex" href="../main/index.html">core</a> |
<a class="qindex" href="../glapi/index.html">glapi</a> |
<a class="qindex" href="../glsl/index.html">glsl</a> |
<a class="qindex" href="../vbo/index.html">vbo</a> |
<a class="qindex" href="../math/index.html">math</a> |
<a class="qindex" href="../shader/index.html">shader</a> |
<a class="qindex" href="../swrast/index.html">swrast</a> |
<a class="qindex" href="../swrast_setup/index.html">swrast_setup</a> |
<a class="qindex" href="../tnl/index.html">tnl</a> |
<a class="qindex" href="../tnl_dd/index.html">tnl_dd</a> |
<a class="qindex" href="../gbm/index.html">gbm</a>
</div>
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_9d873dbfec6053c8a46a8bdca18df976.html">glsl</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">opt_tree_grafting.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Takes assignments to variables that are dereferenced only once and pastes the RHS expression into where the variable is dereferenced.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="ir_8h.html">ir.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ir__visitor_8h.html">ir_visitor.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ir__variable__refcount_8h.html">ir_variable_refcount.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ir__basic__block_8h.html">ir_basic_block.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ir__optimization_8h.html">ir_optimization.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="glsl__types_8h.html">glsl_types.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for opt_tree_grafting.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="opt__tree__grafting_8cpp__incl.png" border="0" usemap="#opt__tree__grafting_8cpp" alt=""/></div>
<map name="opt__tree__grafting_8cpp" id="opt__tree__grafting_8cpp">
<area shape="rect" id="node3" href="ir_8h.html" title="ir.h" alt="" coords="313,155,353,181"/><area shape="rect" id="node19" href="glsl__types_8h.html" title="glsl_types.h" alt="" coords="5,229,96,256"/><area shape="rect" id="node32" href="ir__visitor_8h.html" title="ir_visitor.h" alt="" coords="649,229,732,256"/><area shape="rect" id="node38" href="ir__variable__refcount_8h.html" title="Provides a visitor which produces a list of variables referenced, how many times they were referenced..." alt="" coords="287,80,433,107"/><area shape="rect" id="node43" href="ir__basic__block_8h.html" title="ir_basic_block.h" alt="" coords="509,80,624,107"/><area shape="rect" id="node45" href="ir__optimization_8h.html" title="Prototypes for optimization passes to be called by the compiler and drivers." alt="" coords="649,80,767,107"/><area shape="rect" id="node9" href="ralloc_8h.html" title="ralloc: a recursive memory allocator" alt="" coords="331,304,395,331"/><area shape="rect" id="node27" href="list_8h.html" title="Doubly&#45;linked list abstract container type." alt="" coords="396,229,447,256"/><area shape="rect" id="node34" href="ir__hierarchical__visitor_8h.html" title="ir_hierarchical_visitor.h" alt="" coords="471,229,625,256"/></map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a5ba989ad06353da096de1ef6f6484a03"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="opt__tree__grafting_8cpp.html#a5ba989ad06353da096de1ef6f6484a03">do_tree_grafting</a> (<a class="el" href="structexec__list.html">exec_list</a> *instructions)</td></tr>
<tr class="memdesc:a5ba989ad06353da096de1ef6f6484a03"><td class="mdescLeft">&#160;</td><td class="mdescRight">Does a copy propagation pass on the code present in the instruction stream.  <a href="#a5ba989ad06353da096de1ef6f6484a03">More...</a><br/></td></tr>
<tr class="separator:a5ba989ad06353da096de1ef6f6484a03"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Takes assignments to variables that are dereferenced only once and pastes the RHS expression into where the variable is dereferenced. </p>
<p>In the process of various operations like function inlining and tertiary op handling, we'll end up with our expression trees having been chopped up into a series of assignments of short expressions to temps. Other passes like ir_algebraic.cpp would prefer to see the deepest expression trees they can to try to optimize them.</p>
<p>This is a lot like copy propagaton. In comparison, copy propagation only acts on plain copies, not arbitrary expressions on the RHS. Generally, we wouldn't want to go pasting some complicated expression everywhere it got used, though, so we don't handle expressions in that pass.</p>
<p>The hard part is making sure we don't move an expression across some other assignments that would change the value of the expression. So we split this into two passes: First, find the variables in our scope which are written to once and read once, and then go through basic blocks seeing if we find an opportunity to move those expressions safely. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a5ba989ad06353da096de1ef6f6484a03"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool do_tree_grafting </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structexec__list.html">exec_list</a> *&#160;</td>
          <td class="paramname"><em>instructions</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Does a copy propagation pass on the code present in the instruction stream. </p>

<p>References <a class="el" href="ir__basic__block_8cpp.html#a3f98f9cf58c30c2edcb7c02149fa8821">call_for_basic_blocks()</a>, and <a class="el" href="ir__hierarchical__visitor_8h.html#a3d916e3fe1319c5d975084a1c412aa37">visit_list_elements()</a>.</p>

<p>Referenced by <a class="el" href="ir__optimization_8h.html#a225eedb7a8fad75e2a6e05212b7f70ce">do_common_optimization()</a>, and <a class="el" href="test__optpass_8cpp.html#a8a19eefda8984dbd5d14e58acb3c3189">do_optimization()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="opt__tree__grafting_8cpp_a5ba989ad06353da096de1ef6f6484a03_cgraph.png" border="0" usemap="#opt__tree__grafting_8cpp_a5ba989ad06353da096de1ef6f6484a03_cgraph" alt=""/></div>
<map name="opt__tree__grafting_8cpp_a5ba989ad06353da096de1ef6f6484a03_cgraph" id="opt__tree__grafting_8cpp_a5ba989ad06353da096de1ef6f6484a03_cgraph">
<area shape="rect" id="node3" href="ir__basic__block_8cpp.html#a3f98f9cf58c30c2edcb7c02149fa8821" title="Calls a user function for every basic block in the instruction stream." alt="" coords="168,148,315,175"/><area shape="rect" id="node16" href="ir__hierarchical__visitor_8h.html#a3d916e3fe1319c5d975084a1c412aa37" title="Process a list of nodes using a hierarchical vistor." alt="" coords="176,224,307,251"/><area shape="rect" id="node5" href="classir__instruction.html#ab9b5054185adf8b60331bdc919462633" title="ir_instruction::as_call" alt="" coords="367,5,513,32"/><area shape="rect" id="node7" href="classir__instruction.html#a8ad7b88149bc9f028f7bf7f52f48e7c3" title="ir_instruction::as\l_function" alt="" coords="381,57,499,98"/><area shape="rect" id="node9" href="classir__instruction.html#ab535e6cbf92548da00fdfe821bcceffb" title="ir_instruction::as_if" alt="" coords="374,123,506,149"/><area shape="rect" id="node11" href="classir__instruction.html#af63dce16af60db5d94f764428b7d8a28" title="ir_instruction::as_jump" alt="" coords="363,173,517,200"/><area shape="rect" id="node13" href="classir__instruction.html#a052b6aadaec22eaa9bd32db993f3dd9f" title="ir_instruction::as_loop" alt="" coords="365,224,515,251"/><area shape="rect" id="node18" href="classir__instruction.html#aa797356958ce35850f057499c48a572c" title="ir_instruction::accept" alt="" coords="369,275,511,301"/></map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
